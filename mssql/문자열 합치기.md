# [mssql] 문자열 합치기

문자열을 합쳐야 할 일이 종종 있어서 정리~



## before

| 포지션 | 챔피언명 |
| ------ | -------- |
| 탑     | 티모     |
| 정글   | 마이     |
| 탑     | 말파이트 |
| 정글   | 샤코     |



## after

| seq  | 챔피언명                   |
| ---- | -------------------------- |
| 1    | 티모, 마이, 말파이트, 샤코 |





## 챔피언명을 기준으로 합치기

구글링해보니 커서나 반복문을 통해 처리가 가능하다는데 

커서나 반복문은 쓰고싶지않음. 찾아보니 FOR XML PATH함수를 이용 할 수 있다.



### 1. FOR XML PATH 함수로 실행

```sql
SELECT ',' + 챔피언명
  FROM 챔피언      
FOR XML PATH('')
```

### 결과

| 챔피언명                    |
| --------------------------- |
| ,티모, 마이, 말파이트, 샤코 |

음 원하는 대로 나오긴 했는데 맨앞에 **','** 콤마가 붙음.. 

찾아보니 STUFF 함수를 쓰면 될 것 같다





### 2. STUFF + FOR XML PATH 함수로 실행

```sql
-- 형식 : STUFF(문자변수, 대체할 문자를 대입할 위치, 대체할 문자수, 대체할 문자변수)
SELECT STUFF(( 
            SELECT ',' + 챔피언명
              FROM 챔피언         
               FOR XML PATH('')
       ),1,1,'') AS 템피언명들
```

### 결과

| 챔피언명                   |
| -------------------------- |
| 티모, 마이, 말파이트, 샤코 |
| 티모, 마이, 말파이트, 샤코 |
| 티모, 마이, 말파이트, 샤코 |
| 티모, 마이, 말파이트, 샤코 |

오 세상에 같은게 4번나와 환장하겠네 





### 3. 중복제거는 뭐다? DISTINCT

```sql
SELECT DISTINCT
       STUFF(( 
            SELECT ',' + 챔피언명
              FROM 챔피언         
               FOR XML PATH('')
       ),1,1,'') AS 템피언명들
```

### 결과

| 챔피언명                   |
| -------------------------- |
| 티모, 마이, 말파이트, 샤코 |

굿.







## 포지션을 기준으로 합치기

포지션을 기준으로 합쳐보자.

이걸 더 많이 사용할 것 같음.

```sql
SELECT DISTINCT 포지션,
       STUFF((
            SELECT ',' + 챔피언명
            FROM 챔피언
            WHERE  포지션 = A.포지션
            FOR XML PATH('')
       ),1,1,'') AS 챔피언명들
FROM   챔피언 AS A
```



### 결과

| 포지션 | 챔피언명       |
| ------ | -------------- |
| 정글   | 마이, 샤코     |
| 탑     | 티모, 말파이트 |

끝.